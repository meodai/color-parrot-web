<template>
  <div class="color-detail" v-bind:class="{'color-detail--visible': isReady && show}">
    <svg class="color-detail__logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 180 180">
      <title>color-parrot logo</title>
      <path d="M30 170h80v-60a39.8 39.8 0 0 0-5.25-19.81A80 80 0 0 0 30 170z" fill="#f69"/>
      <path d="M80.36 81.34L63 71.34c-.73-.42-1.42-.87-2.1-1.34H20a30 30 0 0 0 30 30h20a10.07 10.07 0 0 1 1.15.07 79.54 79.54 0 0 1 13.28-5.87 10 10 0 0 0-4.07-12.86zM120 140a10 10 0 0 1-10-10v40a30 30 0 0 0 30-30z" fill="#ed0"/>
      <path d="M70 70h-9.06c.68.47 1.37.92 2.1 1.34l17.32 10a10 10 0 0 1 4.07 12.86 79.64 79.64 0 0 1 20.32-4A40 40 0 0 0 70 70z" fill="#5a0"/><path d="M120 70V50c0-.84 0-1.67.11-2.49L114.64 38l-15-26a30 30 0 0 0-12.13 38.83l7.85 4.53a39.86 39.86 0 0 1 18.51 23.86A10 10 0 0 0 120 70z" fill="#19f"/><path d="M98.66 70.36L88.66 53c-.42-.73-.8-1.46-1.15-2.21L78 45.36l-26-15A30 30 0 0 0 60.94 70H70a39.86 39.86 0 0 1 28 11.41 10 10 0 0 0 .66-11.05z" fill="#6c6"/>
      <path d="M114 100.2a40 40 0 0 0-18.64-44.84l-7.85-4.53c.35.74.73 1.48 1.15 2.21l10 17.32A10 10 0 0 1 98 81.41 40 40 0 0 1 108.74 100H110q2 0 4 .2z" fill="#176"/>
      <path d="M120.11 47.51l4.53 7.85a40 40 0 0 1-4.25 46 39.74 39.74 0 0 1 9 3.63A40 40 0 0 0 150 70V20a30 30 0 0 0-29.89 27.51z" fill="#f69"/>
      <path d="M129.37 105a39.81 39.81 0 0 1-19.37 5v20a10 10 0 0 0 10 10h30a40 40 0 0 0-20.63-35z" fill="#19f"/>
      <path d="M110 110a39.81 39.81 0 0 0 19.37-5 39.47 39.47 0 0 0-9-3.63 40 40 0 0 0 4.25-46l-4.53-7.85c-.07.82-.11 1.65-.11 2.49V70a10 10 0 0 1-6.13 9.22 40 40 0 0 1 .17 21s-2.51-.2-4.05-.2h-1.27A39.89 39.89 0 0 1 110 110z" fill="#139"/>
      <circle cx="87.5" cy="127.5" r="7.5" fill="#fff"/>
    </svg>

    <div class="color-detail__swatch">
      <colorswatch
        v-bind:color="color"
        v-bind:name="currentColor.name"
        v-bind:isVisible="isReady && show"
      ></colorswatch>
    </div>
    <div class="color-detail__story">
      <colorstory
        v-bind:name="currentColor.name"
        v-bind:isVisible="isReady && show"
        v-bind:color="color"
      ></colorstory>
    </div>
    <form
      action="#"
      class="color-detail__mode"
    >
      <select v-model="$store.state.colorMode">
        <option
          v-for="(sort, mode) in $store.state.colorModes"
          v-bind:key="mode"
          v-bind:value="mode"
        >{{sort.label}}</option>
      </select>
    </form>
  </div>
</template>

<script>
import Vue from "vue";
import colorswatch from './components/color-swatch';
import colorstory from './components/color-story';
import chroma from 'chroma-js';

export default Vue.extend({
  components: {
    colorswatch,
    colorstory,
  },
  data: function () {
    return {
      show: false,
      timer: null,
    }
  },
  computed: {
    color () {
      return chroma(this.currentColor.requestedHex);
    },
    currentColor () {
      return this.$store.state.currentColor;
    },
    isReady () {
      return this.$store.state.isReady;
    },
  },
  watch: {},
  methods: {
    urlToColors: function () {

    },
  },
  created () {
    this.$store.dispatch('GET_COLOR', {
      values: [this.$route.params.color_id],
      goodnamesonly: false,
    });
  },
  mounted () {
    this.timer = setTimeout(() => {
      this.show = true;
    }, 100);
  },
  beforeDestroy () {
    this.show = false;
    clearTimeout(this.timer);
  }
});
</script>
<style lang="scss">
.color-detail {
  position: relative;
  min-height: 100vh;
  overflow: hidden;
  @media (orientation: portrait) {
    overflow: auto;
  }
}

.color-detail__swatch,
.color-detail__story {
  position: absolute;
}

.color-detail__swatch {
  z-index: 2;
  opacity: 1;
  width: 20%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);

  @media (orientation: portrait) {
    width: 40%;
  }
}

.color-detail--visible .color-detail__swatch {
  left: 30%;
  transition: 1000ms left cubic-bezier(.3,.7,0,1);
  transition-delay: 900ms;

  @media (orientation: portrait) {
    left: 50%;
    top: 30%;
    transition: 1000ms top cubic-bezier(.3,.7,0,1);
    transition-delay: 900ms;
  }
}

.color-detail__story {
  z-index: 1;

  //--s-label-height: calc((.6rem + 5vmin) * 1.45);
  //height: calc(var(--s-label-height) + 45vw);
  overflow-y: scroll;
  background: #fff;
  color: #001;

  right: 0;
  top: 0;
  bottom: 0;
  width: 40%;
  transform: translateX(110%);
  transition: 600ms transform cubic-bezier(.3,.7,0,1);
  transition-delay: 800ms;

  @media (orientation: portrait) {
    position: relative;
    width: 100%;
    top: 62vh;
    transform: translateY(110%);
  }
}
.color-detail--visible .color-detail__story {
  transform: translateX(0%);
}

.color-story__article {
  > *:not(img) {
    opacity: 0;
    transform: translateX(50%);
    transition: 600ms transform cubic-bezier(.3,.7,0,1),
                200ms opacity linear;
    transition-delay: 870ms, 970ms;
  }
}

.color-detail--visible .color-story__article {
  > *:not(img) {
    transform: translateX(0%);
    opacity: 1;
  }
}

.color-detail__mode {
  opacity: 0;
  position: absolute;
  left: 2rem;
  bottom: 2rem;
  transform: translateY(6rem);
  transition: 600ms transform cubic-bezier(.3,.7,0,1),
              200ms opacity linear;
  transition-delay: 2000ms, 2000ms;
}

.color-detail--visible .color-detail__mode {
  opacity: 1;
  transform: translateY(0rem);
}

.color-detail__logo {
  display: none;
  position: absolute;
  bottom: 2rem;
  right: calc(40% + 2rem);
  width: 1rem;
  height: 1rem;
}

</style>
